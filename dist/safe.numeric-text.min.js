!function(e){function n(e,n){function r(r,a,t,o){function u(e){e=e||0;var n=new RegExp("[\\,\\"+v.currencySymbol+"]","g");return e.toString().replace(n,"")}function i(e,n){throw{Error:e,Message:n}}function l(e){n(function(){e=e||y.val(),o.$setViewValue(e),o.$render()})}function m(e){var n=v.format;e=u(e),y.val(c(n,e)),l()}function c(n,r){return r=r||0,"decimal"==n?e("number")(r,v.decimalPlaces):"int"==n?e("number")(r):"currency"==n||"percentage"==n?e("currency")(r,v.currencySymbol,v.decimalPlaces):void 0}function s(){var e=y.val()||0;""===y.val()&&(e=v.minValue>0?v.minValue:0);var n=v.format;return"decimal"==n?parseFloat(u(e)):"int"==n?parseInt(u(e)):"currency"==n||"percentage"==n?parseFloat(u(e)):void 0}function f(e,n){n.preventDefault(),e>=v.minValue&&e<=v.maxValue?m(e):(e<v.minValue&&(e=c(v.format,v.minValue==Number.NEGATIVE_INFINITY?0:v.minValue)),e>v.maxValue&&(e=c(v.format,v.maxValue)),m(e),d())}function d(){y.addClass(v.errorClass),y.attr("valida-control",!1)}function p(){y.removeClass(v.errorClass),y.attr("valida-control",!0)}var v={format:t.format||"int",decimalPlaces:t.decimalPlaces||2,step:parseFloat(t.step)||0,maxValue:t.maxValue||Number.POSITIVE_INFINITY,minValue:t.minValue||Number.NEGATIVE_INFINITY,currencySymbol:t.currencySymbol||"$",errorClass:t.errorClass||"has-error RequiredField"};"percentage"==v.format&&(v.currencySymbol="%"),"int"!==v.format&&"decimal"!==v.format&&"currency"!==v.format&&"percentage"!==v.format&&i("Invalid Format",'Format "'+v.format+'" is an invalid format for numeric-text, numeric-text only accepts the following formats, \n "int" || "decimal" || "currency" || "percentage"'),v.step<0&&i("Step should not be negative","The step number should be 0 or a positive number"),"number"!=typeof v.step&&i("Step value is not a number",'The value "'+v.step+'" in step is not a number, shoud be a number greater than 0'),v.decimalPlaces<0&&i("DecimalPlaces should not be negative",'The value "" in decimal-places is less then 0, should be a positive number');var y=$(a),b=0,V=/[0-9]/;y.unbind("keydown"),y.on("keydown",function(e){return 0!==v.step&&"number"==typeof v.step&&(38==e.keyCode?(b=s(),b+=v.step,f(b,e)):40==e.keyCode&&(b=s(),b-=v.step,f(b,e))),189==e.keyCode?void f(s()*-1,e):190==e.keyCode&&"int"!=v.format?void(y.val().indexOf(".")!==-1&&e.preventDefault()):void(e.shiftKey===!1?V.test(String.fromCharCode(e.keyCode))||8!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode&&e.preventDefault():e.preventDefault())}),y.unbind("keyup"),y.unbind("change"),y.on("change",function(e){f(s(),e),p()}),y.unbind("focus"),y.on("focus",function(e){$(this).select()}),y.on("keyup",function(e){p()}),y.css("text-align","right"),o.$parsers.push(function(e){return u(e)}),o.$formatters.push(function(e){return e>=v.minValue&&e<=v.maxValue?(l(c(v.format,e)),c(v.format,e)):(e<v.minValue&&(e=c(v.format,v.minValue==Number.NEGATIVE_INFINITY?0:v.minValue)),e>v.maxValue&&(e=c(v.format,v.maxValue)),l(e),c(v.format,e))})}return{restrict:"A",link:r,require:"ngModel"}}e.module("safe.numeric-text",[]).directive("numericText",n),n.$inject=["$filter","$timeout"]}(window.angular);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNhZmUubnVtZXJpYy10ZXh0LmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJudW1lcmljVGV4dCIsIiRmaWx0ZXIiLCIkdGltZW91dCIsImxpbmtGdW5jIiwiJHNjb3BlIiwiJGVsZW1lbnQiLCIkYXR0cnMiLCIkbmdNb2RlbCIsInBhcnNlIiwidmFsdWUiLCJyZWdleCIsIlJlZ0V4cCIsIm9wdGlvbnMiLCJjdXJyZW5jeVN5bWJvbCIsInRvU3RyaW5nIiwicmVwbGFjZSIsInJhaXNlRXhlcHRpb24iLCJlcnJvciIsIm1lc3NhZ2UiLCJFcnJvciIsIk1lc3NhZ2UiLCJ1cGRhdGVNb2RlbCIsImlucHV0IiwidmFsIiwiJHNldFZpZXdWYWx1ZSIsIiRyZW5kZXIiLCJzZXRJbnB1dFZhbHVlIiwiZm9ybWF0IiwiZm9ybWF0dGVyIiwiZGVjaW1hbFBsYWNlcyIsImdldElucHV0VmFsdWUiLCJtaW5WYWx1ZSIsInBhcnNlRmxvYXQiLCJwYXJzZUludCIsImFwcGx5SW5wdXRWYWx1ZSIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJtYXhWYWx1ZSIsIk51bWJlciIsIk5FR0FUSVZFX0lORklOSVRZIiwiaW52YWxpZGF0ZSIsImFkZENsYXNzIiwiZXJyb3JDbGFzcyIsImF0dHIiLCJ2YWxpZGF0ZSIsInJlbW92ZUNsYXNzIiwic3RlcCIsIlBPU0lUSVZFX0lORklOSVRZIiwiJCIsIm51bWJlck1hdGNoIiwidW5iaW5kIiwib24iLCJrZXlDb2RlIiwiaW5kZXhPZiIsInNoaWZ0S2V5IiwidGVzdCIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsInRoaXMiLCJzZWxlY3QiLCJjc3MiLCIkcGFyc2VycyIsInB1c2giLCIkZm9ybWF0dGVycyIsInJlc3RyaWN0IiwibGluayIsInJlcXVpcmUiLCJtb2R1bGUiLCJkaXJlY3RpdmUiLCIkaW5qZWN0Iiwid2luZG93Il0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFVQSxHQVFOLFFBQVNDLEdBQVlDLEVBQVNDLEdBSTFCLFFBQVNDLEdB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UWxCLElBQy9CbUIsRUFBVWhCLEVBQVFlLE9BQVFsQixLQUc3QkEsRUFBUUcsRUFBUW1CLFdBQ2hCdEIsRUFBUW1CLEVBQVVoQixFQUFRZSxPQUFRZixFQUFRbUIsVUFBWU8sT0FBT0Msa0JBQW9CLEVBQUkzQixFQUFRbUIsV0FHN0Z0QixFQUFRRyxFQUFReUIsV0FDaEI1QixFQUFRbUIsRUFBVWhCLEVBQVFlLE9BQVFmLEVBQVF5QixXQUc5Q2hCLEVBQVlaLEdBQ0xtQixFQUFVaEIsRUFBUWUsT0FBUWxCLE1BSzdDLE9BQ0l1RCxTQUFVLElBQ1ZDLEtBQU05RCxFQUNOK0QsUUFBUyxXQWpQakJuRSxFQUFRb0UsT0FBTyx3QkFDVkMsVUFBVSxjQUFlcEUsR0FHOUJBLEVBQVlxRSxTQUFXLFVBQVcsYUFpUG5DQyxPQUFPdkUiLCJmaWxlIjoic2FmZS5udW1lcmljLXRleHQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKGFuZ3VsYXIpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzYWZlLm51bWVyaWMtdGV4dCcsIFtdKVxuICAgICAgICAuZGlyZWN0aXZlKCdudW1lcmljVGV4dCcsIG51bWVyaWNUZXh0KTtcblxuXG4gICAgbnVtZXJpY1RleHQuJGluamVjdCA9IFsnJGZpbHRlcicsICckdGltZW91dCddO1xuXG4gICAgZnVuY3Rpb24gbnVtZXJpY1RleHQoJGZpbHRlciwgJHRpbWVvdXQpIHtcblxuXG5cbiAgICAgICAgZnVuY3Rpb24gbGlua0Z1bmMoJHNjb3BlLCAkZWxlbWVudCwgJGF0dHJzLCAkbmdNb2RlbCkge1xuXG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICBmb3JtYXQ6ICRhdHRycy5mb3JtYXQgfHwgJ2ludCcsIC8vZm9ybWF0ID09ICdkZWNpbWFsJyB8fCAnaW50JyB8fCAnY3VycmVuY3knIHx8IHBlcmNlbnRhZ2VcbiAgICAgICAgICAgICAgICBkZWNpbWFsUGxhY2VzOiAkYXR0cnMuZGVjaW1hbFBsYWNlcyB8fCAyLFxuICAgICAgICAgICAgICAgIHN0ZXA6IHBhcnNlRmxvYXQoJGF0dHJzLnN0ZXApIHx8IDAsXG4gICAgICAgICAgICAgICAgbWF4VmFsdWU6ICRhdHRycy5tYXhWYWx1ZSB8fCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksXG4gICAgICAgICAgICAgICAgbWluVmFsdWU6ICRhdHRycy5taW5WYWx1ZSB8fCBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksXG4gICAgICAgICAgICAgICAgY3VycmVuY3lTeW1ib2w6ICRhdHRycy5jdXJyZW5jeVN5bWJvbCB8fCAnJCcsXG4gICAgICAgICAgICAgICAgZXJyb3JDbGFzczogJGF0dHJzLmVycm9yQ2xhc3MgfHwgJ2hhcy1lcnJvciBSZXF1aXJlZEZpZWxkJ1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKG9wdGlvbnMuZm9ybWF0ID09ICdwZXJjZW50YWdlJykge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuY3VycmVuY3lTeW1ib2wgPSAnJSc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvcHRpb25zLmZvcm1hdCAhPT0gJ2ludCcgJiYgb3B0aW9ucy5mb3JtYXQgIT09ICdkZWNpbWFsJyAmJiBvcHRpb25zLmZvcm1hdCAhPT0gJ2N1cnJlbmN5JyAmJiBvcHRpb25zLmZvcm1hdCAhPT0gJ3BlcmNlbnRhZ2UnKSB7XG4gICAgICAgICAgICAgICAgcmFpc2VFeGVwdGlvbignSW52YWxpZCBGb3JtYXQnLFxuICAgICAgICAgICAgICAgICdGb3JtYXQgXCInICsgb3B0aW9ucy5mb3JtYXQgKyAnXCIgaXMgYW4gaW52YWxpZCBmb3JtYXQgZm9yIG51bWVyaWMtdGV4dCwgbnVtZXJpYy10ZXh0IG9ubHkgYWNjZXB0cyB0aGUgZm9sbG93aW5nIGZvcm1hdHMsIFxcbiBcImludFwiIHx8IFwiZGVjaW1hbFwiIHx8IFwiY3VycmVuY3lcIiB8fCBcInBlcmNlbnRhZ2VcIicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5zdGVwIDwgMCkge1xuICAgICAgICAgICAgICAgIHJhaXNlRXhlcHRpb24oJ1N0ZXAgc2hvdWxkIG5vdCBiZSBuZWdhdGl2ZScsICdUaGUgc3RlcCBudW1iZXIgc2hvdWxkIGJlIDAgb3IgYSBwb3NpdGl2ZSBudW1iZXInKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHR5cGVvZihvcHRpb25zLnN0ZXApICE9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgIHJhaXNlRXhlcHRpb24oJ1N0ZXAgdmFsdWUgaXMgbm90IGEgbnVtYmVyJywgJ1RoZSB2YWx1ZSBcIicgKyBvcHRpb25zLnN0ZXAgKyAnXCIgaW4gc3RlcCBpcyBub3QgYSBudW1iZXIsIHNob3VkIGJlIGEgbnVtYmVyIGdyZWF0ZXIgdGhhbiAwJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKG9wdGlvbnMuZGVjaW1hbFBsYWNlcyA8IDApe1xuICAgICAgICAgICAgICByYWlzZUV4ZXB0aW9uKCdEZWNpbWFsUGxhY2VzIHNob3VsZCBub3QgYmUgbmVnYXRpdmUnLCdUaGUgdmFsdWUgXCJcIiBpbiBkZWNpbWFsLXBsYWNlcyBpcyBsZXNzIHRoZW4gMCwgc2hvdWxkIGJlIGEgcG9zaXRpdmUgbnVtYmVyJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBpbnB1dCA9ICQoJGVsZW1lbnQpO1xuICAgICAgICAgICAgLy8kc2NvcGUubmdNb2RlbCA9ICRzY29wZS5uZ01vZGVsIHx8IDA7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHBhcnNlKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZSB8fCAwO1xuICAgICAgICAgICAgICAgIHZhciByZWdleCA9IG5ldyBSZWdFeHAoXCJbXFxcXCxcXFxcXCIgKyBvcHRpb25zLmN1cnJlbmN5U3ltYm9sICsgXCJdXCIsICdnJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCkucmVwbGFjZShyZWdleCwgJycpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiByYWlzZUV4ZXB0aW9uKGVycm9yLCBtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cge1xuICAgICAgICAgICAgICAgICAgICBFcnJvcjogZXJyb3IsXG4gICAgICAgICAgICAgICAgICAgIE1lc3NhZ2U6IG1lc3NhZ2VcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVNb2RlbCh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlIHx8IGlucHV0LnZhbCgpO1xuICAgICAgICAgICAgICAgICAgICAkbmdNb2RlbC4kc2V0Vmlld1ZhbHVlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgJG5nTW9kZWwuJHJlbmRlcigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRJbnB1dFZhbHVlKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZvcm1hdCA9IG9wdGlvbnMuZm9ybWF0O1xuICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2UodmFsdWUpO1xuICAgICAgICAgICAgICAgIGlucHV0LnZhbChmb3JtYXR0ZXIoZm9ybWF0LCB2YWx1ZSkpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZU1vZGVsKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGZvcm1hdHRlcihmb3JtYXQsIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZSB8fCAwO1xuICAgICAgICAgICAgICAgIGlmIChmb3JtYXQgPT0gJ2RlY2ltYWwnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkZmlsdGVyKCdudW1iZXInKSh2YWx1ZSwgb3B0aW9ucy5kZWNpbWFsUGxhY2VzKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PSAnaW50Jykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGZpbHRlcignbnVtYmVyJykodmFsdWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09ICdjdXJyZW5jeScgfHwgZm9ybWF0ID09ICdwZXJjZW50YWdlJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGZpbHRlcignY3VycmVuY3knKShcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5jdXJyZW5jeVN5bWJvbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGVjaW1hbFBsYWNlcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRJbnB1dFZhbHVlKCkge1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGlucHV0LnZhbCgpIHx8IDA7XG5cbiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsKCkgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm1pblZhbHVlID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBvcHRpb25zLm1pblZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGZvcm1hdCA9IG9wdGlvbnMuZm9ybWF0O1xuXG4gICAgICAgICAgICAgICAgaWYgKGZvcm1hdCA9PSAnZGVjaW1hbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQocGFyc2UodmFsdWUpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PSAnaW50Jykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQocGFyc2UodmFsdWUpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PSAnY3VycmVuY3knIHx8IGZvcm1hdCA9PSAncGVyY2VudGFnZScpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQocGFyc2UodmFsdWUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIG1vdmVDdXJzb3JUb0VuZChlbCkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZWwuc2VsZWN0aW9uU3RhcnQgPT0gXCJudW1iZXJcIikge1xuICAgICAgICAgICAgICAgICAgICBlbC5zZWxlY3Rpb25TdGFydCA9IGVsLnNlbGVjdGlvbkVuZCA9IGVsLnZhbHVlLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBlbC5jcmVhdGVUZXh0UmFuZ2UgIT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgICAgICBlbC5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmFuZ2UgPSBlbC5jcmVhdGVUZXh0UmFuZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2UuY29sbGFwc2UoZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICByYW5nZS5zZWxlY3QoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGFwcGx5SW5wdXRWYWx1ZSh2YWx1ZSwgZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+PSBvcHRpb25zLm1pblZhbHVlICYmIHZhbHVlIDw9IG9wdGlvbnMubWF4VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0SW5wdXRWYWx1ZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPCBvcHRpb25zLm1pblZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGZvcm1hdHRlcihvcHRpb25zLmZvcm1hdCwgb3B0aW9ucy5taW5WYWx1ZSA9PSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkgPyAwIDogb3B0aW9ucy5taW5WYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPiBvcHRpb25zLm1heFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGZvcm1hdHRlcihvcHRpb25zLmZvcm1hdCwgb3B0aW9ucy5tYXhWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc2V0SW5wdXRWYWx1ZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGludmFsaWRhdGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGludmFsaWRhdGUoKSB7XG4gICAgICAgICAgICAgICAgaW5wdXQuYWRkQ2xhc3Mob3B0aW9ucy5lcnJvckNsYXNzKTtcbiAgICAgICAgICAgICAgICBpbnB1dC5hdHRyKCd2YWxpZGEtY29udHJvbCcsIGZhbHNlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gdmFsaWRhdGUoKSB7XG4gICAgICAgICAgICAgICAgaW5wdXQucmVtb3ZlQ2xhc3Mob3B0aW9ucy5lcnJvckNsYXNzKTtcbiAgICAgICAgICAgICAgICBpbnB1dC5hdHRyKCd2YWxpZGEtY29udHJvbCcsIHRydWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSAwO1xuICAgICAgICAgICAgdmFyIG51bWJlck1hdGNoID0gL1swLTldLztcbiAgICAgICAgICAgIGlucHV0LnVuYmluZCgna2V5ZG93bicpO1xuICAgICAgICAgICAgaW5wdXQub24oJ2tleWRvd24nLCBmdW5jdGlvbihldmVudCkge1xuXG5cbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zdGVwICE9PSAwICYmIHR5cGVvZihvcHRpb25zLnN0ZXApID09ICdudW1iZXInKSB7XG5cblxuICAgICAgICAgICAgICAgICAgICAvL1N0ZXAgdXBcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gMzgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZ2V0SW5wdXRWYWx1ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gb3B0aW9ucy5zdGVwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwbHlJbnB1dFZhbHVlKHZhbHVlLCBldmVudCk7XG5cblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleUNvZGUgPT0gNDApIHsgLy9TdGVwIGRvd25cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZ2V0SW5wdXRWYWx1ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgLT0gb3B0aW9ucy5zdGVwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwbHlJbnB1dFZhbHVlKHZhbHVlLCBldmVudCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgICAgIC8vTWludXNcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSAxODkpIHtcbiAgICAgICAgICAgICAgICAgICAgYXBwbHlJbnB1dFZhbHVlKGdldElucHV0VmFsdWUoKSAqIC0xLCBldmVudCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gMTkwICYmIG9wdGlvbnMuZm9ybWF0ICE9ICdpbnQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWwoKS5pbmRleE9mKCcuJykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LnNoaWZ0S2V5ID09PSBmYWxzZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghbnVtYmVyTWF0Y2gudGVzdChTdHJpbmcuZnJvbUNoYXJDb2RlKGV2ZW50LmtleUNvZGUpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgIT0gOCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LmtleUNvZGUgIT0gMzcgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5rZXlDb2RlICE9IDM5KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaW5wdXQudW5iaW5kKCdrZXl1cCcpO1xuICAgICAgICAgICAgaW5wdXQudW5iaW5kKCdjaGFuZ2UnKTtcbiAgICAgICAgICAgIGlucHV0Lm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgIGFwcGx5SW5wdXRWYWx1ZShnZXRJbnB1dFZhbHVlKCksIGV2ZW50KTtcbiAgICAgICAgICAgICAgICB2YWxpZGF0ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpbnB1dC51bmJpbmQoJ2ZvY3VzJyk7XG4gICAgICAgICAgICBpbnB1dC5vbignZm9jdXMnLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICQodGhpcykuc2VsZWN0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlucHV0Lm9uKCdrZXl1cCcsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgdmFsaWRhdGUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpbnB1dC5jc3MoJ3RleHQtYWxpZ24nLCAncmlnaHQnKTtcblxuICAgICAgICAgICAgJG5nTW9kZWwuJHBhcnNlcnMucHVzaChmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZSh2YWx1ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRuZ01vZGVsLiRmb3JtYXR0ZXJzLnB1c2goZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPj0gb3B0aW9ucy5taW5WYWx1ZSAmJiB2YWx1ZSA8PSBvcHRpb25zLm1heFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZU1vZGVsKGZvcm1hdHRlcihvcHRpb25zLmZvcm1hdCwgdmFsdWUpKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdHRlcihvcHRpb25zLmZvcm1hdCwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgb3B0aW9ucy5taW5WYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBmb3JtYXR0ZXIob3B0aW9ucy5mb3JtYXQsIG9wdGlvbnMubWluVmFsdWUgPT0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZID8gMCA6IG9wdGlvbnMubWluVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gb3B0aW9ucy5tYXhWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBmb3JtYXR0ZXIob3B0aW9ucy5mb3JtYXQsIG9wdGlvbnMubWF4VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlTW9kZWwodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0dGVyKG9wdGlvbnMuZm9ybWF0LCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgIGxpbms6IGxpbmtGdW5jLFxuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnXG4gICAgICAgIH07XG4gICAgfVxuXG59KSh3aW5kb3cuYW5ndWxhcik7XG4iXX0=
