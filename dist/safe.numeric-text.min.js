!function(e){function n(e,n){function r(r,a,t,o){function i(e){e=e||0;var n=new RegExp("[\\,\\"+v.currencySymbol+"]","g");return e.toString().replace(n,"")}function u(e,n){throw{Error:e,Message:n}}function l(e){n(function(){e=e||y.val(),o.$setViewValue(e),o.$render()})}function c(e){var n=v.format;e=i(e),y.val(m(n,e)),l()}function m(n,r){return r=r||0,"decimal"==n?e("number")(r,v.decimalPlaces):"int"==n?e("number")(r):"currency"==n||"percentage"==n?e("currency")(r,v.currencySymbol,v.decimalPlaces):void 0}function s(){var e=y.val()||0;""===y.val()&&(e=v.minValue>0?v.minValue:0);var n=v.format;return"decimal"==n?parseFloat(i(e)):"int"==n?parseInt(i(e)):"currency"==n||"percentage"==n?parseFloat(i(e)):void 0}function f(e,n){n.preventDefault(),e>=v.minValue&&e<=v.maxValue?c(e):(e<v.minValue&&(e=m(v.format,v.minValue==Number.NEGATIVE_INFINITY?0:v.minValue)),e>v.maxValue&&(e=m(v.format,v.maxValue)),c(e),d())}function d(){y.addClass(v.errorClass),y.attr("valida-control",!1)}function p(){y.removeClass(v.errorClass),y.attr("valida-control",!0)}var v={format:t.format||"int",decimalPlaces:t.decimalPlaces||2,step:parseFloat(t.step)||0,maxValue:t.maxValue||Number.POSITIVE_INFINITY,minValue:t.minValue||Number.NEGATIVE_INFINITY,currencySymbol:t.currencySymbol||"$",errorClass:t.errorClass||"has-error RequiredField"};"percentage"==v.format&&(v.currencySymbol="%"),"int"!==v.format&&"decimal"!==v.format&&"currency"!==v.format&&"percentage"!==v.format&&u("Invalid Format",'Format "'+v.format+'" is an invalid format for numeric-text, numeric-text only accepts the following formats, \n "int" || "decimal" || "currency" || "percentage"'),v.step<0&&u("Step should not be negative","The step number should be 0 or a positive number"),"number"!=typeof v.step&&u("Step value is not a number",'The value "'+v.step+'" in step is not a number, shoud be a number greater than 0'),v.decimalPlaces<0&&u("DecimalPlaces should not be negative",'The value "" in decimal-places is less then 0, should be a positive number');var y=$(a),b=0,V=/[0-9]/;y.unbind("keydown"),y.on("keydown",function(e){return 0!==v.step&&"number"==typeof v.step&&(38==e.keyCode?(b=s(),b+=v.step,f(b,e)):40==e.keyCode&&(b=s(),b-=v.step,f(b,e))),189==e.keyCode?void f(s()*-1,e):190==e.keyCode&&"int"!=v.format?void(y.val().indexOf(".")!==-1&&e.preventDefault()):void(e.shiftKey===!1?V.test(String.fromCharCode(e.keyCode))||8!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode&&e.preventDefault():e.preventDefault())}),y.unbind("keyup"),y.unbind("change"),y.on("change",function(e){f(s(),e),p()}),y.unbind("click"),y.on("click",function(e){var n=$(this)[0];n.setSelectionRange(0,n.value.length)}),y.on("keyup",function(e){p()}),y.css("text-align","right"),o.$parsers.push(function(e){return i(e)}),o.$formatters.push(function(e){return e>=v.minValue&&e<=v.maxValue?(l(m(v.format,e)),m(v.format,e)):(e<v.minValue&&(e=m(v.format,v.minValue==Number.NEGATIVE_INFINITY?0:v.minValue)),e>v.maxValue&&(e=m(v.format,v.maxValue)),l(e),m(v.format,e))})}return{restrict:"A",link:r,require:"ngModel"}}e.module("safe.numeric-text",[]).directive("numericText",n),n.$inject=["$filter","$timeout"]}(window.angular);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNhZmUubnVtZXJpYy10ZXh0LmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJudW1lcmljVGV4dCIsIiRmaWx0ZXIiLCIkdGltZW91dCIsImxpbmtGdW5jIiwiJHNjb3BlIiwiJGVsZW1lbnQiLCIkYXR0cnMiLCIkbmdNb2RlbCIsInBhcnNlIiwidmFsdWUiLCJyZWdleCIsIlJlZ0V4cCIsIm9wdGlvbnMiLCJjdXJyZW5jeVN5bWJvbCIsInRvU3RyaW5nIiwicmVwbGFjZSIsInJhaXNlRXhlcHRpb24iLCJlcnJvciIsIm1lc3NhZ2UiLCJFcnJvciIsIk1lc3NhZ2UiLCJ1cGRhdGVNb2RlbCIsImlucHV0IiwidmFsIiwiJHNldFZpZXdWYWx1ZSIsIiRyZW5kZXIiLCJzZXRJbnB1dFZhbHVlIiwiZm9ybWF0IiwiZm9ybWF0dGVyIiwiZGVjaW1hbFBsYWNlcyIsImdldElucHV0VmFsdWUiLCJtaW5WYWx1ZSIsInBhcnNlRmxvYXQiLCJwYXJzZUludCIsImFwcGx5SW5wdXRWYWx1ZSIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJtYXhWYWx1ZSIsIk51bWJlciIsIk5FR0FUSVZFX0lORklOSVRZIiwiaW52YWxpZGF0ZSIsImFkZENsYXNzIiwiZXJyb3JDbGFzcyIsImF0dHIiLCJ2YWxpZGF0ZSIsInJlbW92ZUNsYXNzIiwic3RlcCIsIlBPU0lUSVZFX0lORklOSVRZIiwiJCIsIm51bWJlck1hdGNoIiwidW5iaW5kIiwib24iLCJrZXlDb2RlIiwiaW5kZXhPZiIsInNoaWZ0S2V5IiwidGVzdCIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsIl90aGlzIiwidGhpcyIsInNldFNlbGVjdGlvblJhbmdlIiwibGVuZ3RoIiwiY3NzIiwiJHBhcnNlcnMiLCJwdXNoIiwiJGZvcm1hdHRlcnMiLCJyZXN0cmljdCIsImxpbmsiLCJyZXF1aXJlIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwiJGluamVjdCIsIndpbmRvdyJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBVUEsR0FRTixRQUFT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QVN2RCxHQUMvQixNQUFJQSxJQUFTRyxFQUFRbUIsVUFBWXRCLEdBQVNHLEVBQVF5QixVQUM5Q2hCLEVBQVlPLEVBQVVoQixFQUFRZSxPQUFRbEIsSUFDL0JtQixFQUFVaEIsRUFBUWUsT0FBUWxCLEtBRzdCQSxFQUFRRyxFQUFRbUIsV0FDaEJ0QixFQUFRbUIsRUFBVWhCLEVBQVFlLE9BQVFmLEVBQVFtQixVQUFZTyxPQUFPQyxrQkFBb0IsRUFBSTNCLEVBQVFtQixXQUc3RnRCLEVBQVFHLEVBQVF5QixXQUNoQjVCLEVBQVFtQixFQUFVaEIsRUFBUWUsT0FBUWYsRUFBUXlCLFdBRzlDaEIsRUFBWVosR0FDTG1CLEVBQVVoQixFQUFRZSxPQUFRbEIsTUFLN0MsT0FDSXlELFNBQVUsSUFDVkMsS0FBTWhFLEVBQ05pRSxRQUFTLFdBblBqQnJFLEVBQVFzRSxPQUFPLHdCQUNWQyxVQUFVLGNBQWV0RSxHQUc5QkEsRUFBWXVFLFNBQVcsVUFBVyxhQW1QbkNDLE9BQU96RSIsImZpbGUiOiJzYWZlLm51bWVyaWMtdGV4dC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oYW5ndWxhcikge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NhZmUubnVtZXJpYy10ZXh0JywgW10pXG4gICAgICAgIC5kaXJlY3RpdmUoJ251bWVyaWNUZXh0JywgbnVtZXJpY1RleHQpO1xuXG5cbiAgICBudW1lcmljVGV4dC4kaW5qZWN0ID0gWyckZmlsdGVyJywgJyR0aW1lb3V0J107XG5cbiAgICBmdW5jdGlvbiBudW1lcmljVGV4dCgkZmlsdGVyLCAkdGltZW91dCkge1xuXG5cblxuICAgICAgICBmdW5jdGlvbiBsaW5rRnVuYygkc2NvcGUsICRlbGVtZW50LCAkYXR0cnMsICRuZ01vZGVsKSB7XG5cbiAgICAgICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgICAgIGZvcm1hdDogJGF0dHJzLmZvcm1hdCB8fCAnaW50JywgLy9mb3JtYXQgPT0gJ2RlY2ltYWwnIHx8ICdpbnQnIHx8ICdjdXJyZW5jeScgfHwgcGVyY2VudGFnZVxuICAgICAgICAgICAgICAgIGRlY2ltYWxQbGFjZXM6ICRhdHRycy5kZWNpbWFsUGxhY2VzIHx8IDIsXG4gICAgICAgICAgICAgICAgc3RlcDogcGFyc2VGbG9hdCgkYXR0cnMuc3RlcCkgfHwgMCxcbiAgICAgICAgICAgICAgICBtYXhWYWx1ZTogJGF0dHJzLm1heFZhbHVlIHx8IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSxcbiAgICAgICAgICAgICAgICBtaW5WYWx1ZTogJGF0dHJzLm1pblZhbHVlIHx8IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSxcbiAgICAgICAgICAgICAgICBjdXJyZW5jeVN5bWJvbDogJGF0dHJzLmN1cnJlbmN5U3ltYm9sIHx8ICckJyxcbiAgICAgICAgICAgICAgICBlcnJvckNsYXNzOiAkYXR0cnMuZXJyb3JDbGFzcyB8fCAnaGFzLWVycm9yIFJlcXVpcmVkRmllbGQnXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5mb3JtYXQgPT0gJ3BlcmNlbnRhZ2UnKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5jdXJyZW5jeVN5bWJvbCA9ICclJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG9wdGlvbnMuZm9ybWF0ICE9PSAnaW50JyAmJiBvcHRpb25zLmZvcm1hdCAhPT0gJ2RlY2ltYWwnICYmIG9wdGlvbnMuZm9ybWF0ICE9PSAnY3VycmVuY3knICYmIG9wdGlvbnMuZm9ybWF0ICE9PSAncGVyY2VudGFnZScpIHtcbiAgICAgICAgICAgICAgICByYWlzZUV4ZXB0aW9uKCdJbnZhbGlkIEZvcm1hdCcsXG4gICAgICAgICAgICAgICAgJ0Zvcm1hdCBcIicgKyBvcHRpb25zLmZvcm1hdCArICdcIiBpcyBhbiBpbnZhbGlkIGZvcm1hdCBmb3IgbnVtZXJpYy10ZXh0LCBudW1lcmljLXRleHQgb25seSBhY2NlcHRzIHRoZSBmb2xsb3dpbmcgZm9ybWF0cywgXFxuIFwiaW50XCIgfHwgXCJkZWNpbWFsXCIgfHwgXCJjdXJyZW5jeVwiIHx8IFwicGVyY2VudGFnZVwiJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvcHRpb25zLnN0ZXAgPCAwKSB7XG4gICAgICAgICAgICAgICAgcmFpc2VFeGVwdGlvbignU3RlcCBzaG91bGQgbm90IGJlIG5lZ2F0aXZlJywgJ1RoZSBzdGVwIG51bWJlciBzaG91bGQgYmUgMCBvciBhIHBvc2l0aXZlIG51bWJlcicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodHlwZW9mKG9wdGlvbnMuc3RlcCkgIT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICAgICAgcmFpc2VFeGVwdGlvbignU3RlcCB2YWx1ZSBpcyBub3QgYSBudW1iZXInLCAnVGhlIHZhbHVlIFwiJyArIG9wdGlvbnMuc3RlcCArICdcIiBpbiBzdGVwIGlzIG5vdCBhIG51bWJlciwgc2hvdWQgYmUgYSBudW1iZXIgZ3JlYXRlciB0aGFuIDAnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYob3B0aW9ucy5kZWNpbWFsUGxhY2VzIDwgMCl7XG4gICAgICAgICAgICAgIHJhaXNlRXhlcHRpb24oJ0RlY2ltYWxQbGFjZXMgc2hvdWxkIG5vdCBiZSBuZWdhdGl2ZScsJ1RoZSB2YWx1ZSBcIlwiIGluIGRlY2ltYWwtcGxhY2VzIGlzIGxlc3MgdGhlbiAwLCBzaG91bGQgYmUgYSBwb3NpdGl2ZSBudW1iZXInKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGlucHV0ID0gJCgkZWxlbWVudCk7XG4gICAgICAgICAgICAvLyRzY29wZS5uZ01vZGVsID0gJHNjb3BlLm5nTW9kZWwgfHwgMDtcblxuICAgICAgICAgICAgZnVuY3Rpb24gcGFyc2UodmFsdWUpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlIHx8IDA7XG4gICAgICAgICAgICAgICAgdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cChcIltcXFxcLFxcXFxcIiArIG9wdGlvbnMuY3VycmVuY3lTeW1ib2wgKyBcIl1cIiwgJ2cnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKS5yZXBsYWNlKHJlZ2V4LCAnJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHJhaXNlRXhlcHRpb24oZXJyb3IsIG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyB7XG4gICAgICAgICAgICAgICAgICAgIEVycm9yOiBlcnJvcixcbiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZTogbWVzc2FnZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZU1vZGVsKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgfHwgaW5wdXQudmFsKCk7XG4gICAgICAgICAgICAgICAgICAgICRuZ01vZGVsLiRzZXRWaWV3VmFsdWUodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAkbmdNb2RlbC4kcmVuZGVyKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldElucHV0VmFsdWUodmFsdWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZm9ybWF0ID0gb3B0aW9ucy5mb3JtYXQ7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgaW5wdXQudmFsKGZvcm1hdHRlcihmb3JtYXQsIHZhbHVlKSk7XG4gICAgICAgICAgICAgICAgdXBkYXRlTW9kZWwoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZm9ybWF0dGVyKGZvcm1hdCwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlIHx8IDA7XG4gICAgICAgICAgICAgICAgaWYgKGZvcm1hdCA9PSAnZGVjaW1hbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRmaWx0ZXIoJ251bWJlcicpKHZhbHVlLCBvcHRpb25zLmRlY2ltYWxQbGFjZXMpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09ICdpbnQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkZmlsdGVyKCdudW1iZXInKSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT0gJ2N1cnJlbmN5JyB8fCBmb3JtYXQgPT0gJ3BlcmNlbnRhZ2UnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkZmlsdGVyKCdjdXJyZW5jeScpKFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmN1cnJlbmN5U3ltYm9sLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kZWNpbWFsUGxhY2VzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldElucHV0VmFsdWUoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaW5wdXQudmFsKCkgfHwgMDtcblxuICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWwoKSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubWluVmFsdWUgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IG9wdGlvbnMubWluVmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgZm9ybWF0ID0gb3B0aW9ucy5mb3JtYXQ7XG5cbiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0ID09ICdkZWNpbWFsJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChwYXJzZSh2YWx1ZSkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09ICdpbnQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUludChwYXJzZSh2YWx1ZSkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09ICdjdXJyZW5jeScgfHwgZm9ybWF0ID09ICdwZXJjZW50YWdlJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChwYXJzZSh2YWx1ZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gbW92ZUN1cnNvclRvRW5kKGVsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlbC5zZWxlY3Rpb25TdGFydCA9PSBcIm51bWJlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsLnNlbGVjdGlvblN0YXJ0ID0gZWwuc2VsZWN0aW9uRW5kID0gZWwudmFsdWUubGVuZ3RoO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGVsLmNyZWF0ZVRleHRSYW5nZSAhPSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IGVsLmNyZWF0ZVRleHRSYW5nZSgpO1xuICAgICAgICAgICAgICAgICAgICByYW5nZS5jb2xsYXBzZShmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIHJhbmdlLnNlbGVjdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gYXBwbHlJbnB1dFZhbHVlKHZhbHVlLCBldmVudCkge1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID49IG9wdGlvbnMubWluVmFsdWUgJiYgdmFsdWUgPD0gb3B0aW9ucy5tYXhWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBzZXRJbnB1dFZhbHVlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IG9wdGlvbnMubWluVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZm9ybWF0dGVyKG9wdGlvbnMuZm9ybWF0LCBvcHRpb25zLm1pblZhbHVlID09IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSA/IDAgOiBvcHRpb25zLm1pblZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+IG9wdGlvbnMubWF4VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZm9ybWF0dGVyKG9wdGlvbnMuZm9ybWF0LCBvcHRpb25zLm1heFZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzZXRJbnB1dFZhbHVlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgaW52YWxpZGF0ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gaW52YWxpZGF0ZSgpIHtcbiAgICAgICAgICAgICAgICBpbnB1dC5hZGRDbGFzcyhvcHRpb25zLmVycm9yQ2xhc3MpO1xuICAgICAgICAgICAgICAgIGlucHV0LmF0dHIoJ3ZhbGlkYS1jb250cm9sJywgZmFsc2UpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiB2YWxpZGF0ZSgpIHtcbiAgICAgICAgICAgICAgICBpbnB1dC5yZW1vdmVDbGFzcyhvcHRpb25zLmVycm9yQ2xhc3MpO1xuICAgICAgICAgICAgICAgIGlucHV0LmF0dHIoJ3ZhbGlkYS1jb250cm9sJywgdHJ1ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IDA7XG4gICAgICAgICAgICB2YXIgbnVtYmVyTWF0Y2ggPSAvWzAtOV0vO1xuICAgICAgICAgICAgaW5wdXQudW5iaW5kKCdrZXlkb3duJyk7XG4gICAgICAgICAgICBpbnB1dC5vbigna2V5ZG93bicsIGZ1bmN0aW9uKGV2ZW50KSB7XG5cblxuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN0ZXAgIT09IDAgJiYgdHlwZW9mKG9wdGlvbnMuc3RlcCkgPT0gJ251bWJlcicpIHtcblxuXG4gICAgICAgICAgICAgICAgICAgIC8vU3RlcCB1cFxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSAzOCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBnZXRJbnB1dFZhbHVlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSBvcHRpb25zLnN0ZXA7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHBseUlucHV0VmFsdWUodmFsdWUsIGV2ZW50KTtcblxuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5Q29kZSA9PSA0MCkgeyAvL1N0ZXAgZG93blxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBnZXRJbnB1dFZhbHVlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSAtPSBvcHRpb25zLnN0ZXA7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHBseUlucHV0VmFsdWUodmFsdWUsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICAgICAgLy9NaW51c1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09IDE4OSkge1xuICAgICAgICAgICAgICAgICAgICBhcHBseUlucHV0VmFsdWUoZ2V0SW5wdXRWYWx1ZSgpICogLTEsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSAxOTAgJiYgb3B0aW9ucy5mb3JtYXQgIT0gJ2ludCcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbCgpLmluZGV4T2YoJy4nKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuc2hpZnRLZXkgPT09IGZhbHNlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFudW1iZXJNYXRjaC50ZXN0KFN0cmluZy5mcm9tQ2hhckNvZGUoZXZlbnQua2V5Q29kZSkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSAhPSA4ICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQua2V5Q29kZSAhPSAzNyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LmtleUNvZGUgIT0gMzkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpbnB1dC51bmJpbmQoJ2tleXVwJyk7XG4gICAgICAgICAgICBpbnB1dC51bmJpbmQoJ2NoYW5nZScpO1xuICAgICAgICAgICAgaW5wdXQub24oJ2NoYW5nZScsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgYXBwbHlJbnB1dFZhbHVlKGdldElucHV0VmFsdWUoKSwgZXZlbnQpO1xuICAgICAgICAgICAgICAgIHZhbGlkYXRlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlucHV0LnVuYmluZCgnY2xpY2snKTtcbiAgICAgICAgICAgIGlucHV0Lm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gJCh0aGlzKVswXTtcbiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTZWxlY3Rpb25SYW5nZSgwLCBfdGhpcy52YWx1ZS5sZW5ndGgpO1xuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlucHV0Lm9uKCdrZXl1cCcsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgdmFsaWRhdGUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpbnB1dC5jc3MoJ3RleHQtYWxpZ24nLCAncmlnaHQnKTtcblxuICAgICAgICAgICAgJG5nTW9kZWwuJHBhcnNlcnMucHVzaChmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZSh2YWx1ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRuZ01vZGVsLiRmb3JtYXR0ZXJzLnB1c2goZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPj0gb3B0aW9ucy5taW5WYWx1ZSAmJiB2YWx1ZSA8PSBvcHRpb25zLm1heFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZU1vZGVsKGZvcm1hdHRlcihvcHRpb25zLmZvcm1hdCwgdmFsdWUpKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdHRlcihvcHRpb25zLmZvcm1hdCwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgb3B0aW9ucy5taW5WYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBmb3JtYXR0ZXIob3B0aW9ucy5mb3JtYXQsIG9wdGlvbnMubWluVmFsdWUgPT0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZID8gMCA6IG9wdGlvbnMubWluVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gb3B0aW9ucy5tYXhWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBmb3JtYXR0ZXIob3B0aW9ucy5mb3JtYXQsIG9wdGlvbnMubWF4VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlTW9kZWwodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0dGVyKG9wdGlvbnMuZm9ybWF0LCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgIGxpbms6IGxpbmtGdW5jLFxuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnXG4gICAgICAgIH07XG4gICAgfVxuXG59KSh3aW5kb3cuYW5ndWxhcik7XG4iXX0=
