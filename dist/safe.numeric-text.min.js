!function(e){function n(e,n){function r(r,a,t,o){function i(e){e=e||0;var n=new RegExp("[\\,\\"+v.currencySymbol+"]","g");return e.toString().replace(n,"")}function u(e,n){throw{Error:e,Message:n}}function l(e){n(function(){e=e||y.val(),o.$setViewValue(e),o.$render()})}function c(e){var n=v.format;e=i(e),y.val(m(n,e)),l()}function m(n,r){return r=r||0,"decimal"==n?e("number")(r,v.decimalPlaces):"int"==n?e("number")(r):"currency"==n||"percentage"==n?e("currency")(r,v.currencySymbol,v.decimalPlaces):void 0}function s(){var e=y.val()||0;""===y.val()&&(e=v.minValue>0?v.minValue:0);var n=v.format;return"decimal"==n?parseFloat(i(e)):"int"==n?parseInt(i(e)):"currency"==n||"percentage"==n?parseFloat(i(e)):void 0}function f(e,n){n.preventDefault(),e>=v.minValue&&e<=v.maxValue?c(e):(e<v.minValue&&(e=m(v.format,v.minValue==Number.NEGATIVE_INFINITY?0:v.minValue)),e>v.maxValue&&(e=m(v.format,v.maxValue)),c(e),d())}function d(){y.addClass(v.errorClass),y.attr("valida-control",!1)}function p(){y.removeClass(v.errorClass),y.attr("valida-control",!0)}var v={format:t.format||"int",decimalPlaces:t.decimalPlaces||2,step:parseFloat(t.step)||0,maxValue:t.maxValue||Number.POSITIVE_INFINITY,minValue:t.minValue||Number.NEGATIVE_INFINITY,currencySymbol:t.currencySymbol||"$",errorClass:t.errorClass||"has-error RequiredField"};"percentage"==v.format&&(v.currencySymbol="%"),"int"!==v.format&&"decimal"!==v.format&&"currency"!==v.format&&"percentage"!==v.format&&u("Invalid Format",'Format "'+v.format+'" is an invalid format for numeric-text, numeric-text only accepts the following formats, \n "int" || "decimal" || "currency" || "percentage"'),v.step<0&&u("Step should not be negative","The step number should be 0 or a positive number"),"number"!=typeof v.step&&u("Step value is not a number",'The value "'+v.step+'" in step is not a number, shoud be a number greater than 0'),v.decimalPlaces<0&&u("DecimalPlaces should not be negative",'The value "" in decimal-places is less then 0, should be a positive number');var y=$(a),b=0,V=/[0-9]/;y.unbind("keydown"),y.on("keydown",function(e){if(0!==v.step&&"number"==typeof v.step&&(38==e.keyCode?(b=s(),b+=v.step,f(b,e)):40==e.keyCode&&(b=s(),b-=v.step,f(b,e))),189==e.keyCode)return void f(-1*s(),e);if(190==e.keyCode&&"int"!=v.format)return void(-1!==y.val().indexOf(".")&&e.preventDefault());if(!1===e.shiftKey){var n=!1;e.keyCode>=96&&e.keyCode<=105&&(n=!0),n||V.test(String.fromCharCode(e.keyCode))||8!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode&&e.preventDefault()}else e.preventDefault()}),y.unbind("keyup"),y.unbind("change"),y.on("change",function(e){f(s(),e),p()}),y.unbind("click"),y.on("click",function(e){var n=$(this)[0];n.setSelectionRange(0,n.value.length)}),y.on("keyup",function(e){p()}),y.css("text-align","right"),o.$parsers.push(function(e){return i(e)}),o.$formatters.push(function(e){return e>=v.minValue&&e<=v.maxValue?(l(m(v.format,e)),m(v.format,e)):(e<v.minValue&&(e=m(v.format,v.minValue==Number.NEGATIVE_INFINITY?0:v.minValue)),e>v.maxValue&&(e=m(v.format,v.maxValue)),l(e),m(v.format,e))})}return{restrict:"A",link:r,require:"ngModel"}}e.module("safe.numeric-text",[]).directive("numericText",n),n.$inject=["$filter","$timeout"]}(window.angular);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNhZmUubnVtZXJpYy10ZXh0LmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJudW1lcmljVGV4dCIsIiRmaWx0ZXIiLCIkdGltZW91dCIsImxpbmtGdW5jIiwiJHNjb3BlIiwiJGVsZW1lbnQiLCIkYXR0cnMiLCIkbmdNb2RlbCIsInBhcnNlIiwidmFsdWUiLCJyZWdleCIsIlJlZ0V4cCIsIm9wdGlvbnMiLCJjdXJyZW5jeVN5bWJvbCIsInRvU3RyaW5nIiwicmVwbGFjZSIsInJhaXNlRXhlcHRpb24iLCJlcnJvciIsIm1lc3NhZ2UiLCJFcnJvciIsIk1lc3NhZ2UiLCJ1cGRhdGVNb2RlbCIsImlucHV0IiwidmFsIiwiJHNldFZpZXdWYWx1ZSIsIiRyZW5kZXIiLCJzZXRJbnB1dFZhbHVlIiwiZm9ybWF0IiwiZm9ybWF0dGVyIiwiZGVjaW1hbFBsYWNlcyIsImdldElucHV0VmFsdWUiLCJtaW5WYWx1ZSIsInBhcnNlRmxvYXQiLCJwYXJzZUludCIsImFwcGx5SW5wdXRWYWx1ZSIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJtYXhWYWx1ZSIsIk51bWJlciIsIk5FR0FUSVZFX0lORklOSVRZIiwiaW52YWxpZGF0ZSIsImFkZENsYXNzIiwiZXJyb3JDbGFzcyIsImF0dHIiLCJ2YWxpZGF0ZSIsInJlbW92ZUNsYXNzIiwic3RlcCIsIlBPU0lUSVZFX0lORklOSVRZIiwiJCIsIm51bWJlck1hdGNoIiwidW5iaW5kIiwib24iLCJrZXlDb2RlIiwiaW5kZXhPZiIsInNoaWZ0S2V5IiwiaXNGcm9tTnVtcGFkIiwidGVzdCIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsIl90aGlzIiwidGhpcyIsInNldFNlbGVjdGlvblJhbmdlIiwibGVuZ3RoIiwiY3NzIiwiJHBhcnNlcnMiLCJwdXNoIiwiJGZvcm1hdHRlcnMiLCJyZXN0cmljdCIsImxpbmsiLCJyZXF1aXJlIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwiJGluamVjdCIsIndpbmRvdyJdLCJtYXBwaW5ncyI6IkNBQUEs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RyxRQUFTLFNBQVNoQixHQUN2QlMsTUFHSnRCLEVBQU15QyxJQUFJLGFBQWMsU0FFeEJ4RCxFQUFTeUQsU0FBU0MsS0FBSyxTQUFTeEQsR0FDNUIsTUFBT0QsR0FBTUMsS0FFakJGLEVBQVMyRCxZQUFZRCxLQUFLLFNBQVN4RCxHQUMvQixNQUFJQSxJQUFTRyxFQUFRbUIsVUFBWXRCLEdBQVNHLEVBQVF5QixVQUM5Q2hCLEVBQVlPLEVBQVVoQixFQUFRZSxPQUFRbEIsSUFDL0JtQixFQUFVaEIsRUFBUWUsT0FBUWxCLEtBRzdCQSxFQUFRRyxFQUFRbUIsV0FDaEJ0QixFQUFRbUIsRUFBVWhCLEVBQVFlLE9BQVFmLEVBQVFtQixVQUFZTyxPQUFPQyxrQkFBb0IsRUFBSTNCLEVBQVFtQixXQUc3RnRCLEVBQVFHLEVBQVF5QixXQUNoQjVCLEVBQVFtQixFQUFVaEIsRUFBUWUsT0FBUWYsRUFBUXlCLFdBRzlDaEIsRUFBWVosR0FDTG1CLEVBQVVoQixFQUFRZSxPQUFRbEIsTUFLN0MsT0FDSTBELFNBQVUsSUFDVkMsS0FBTWpFLEVBQ05rRSxRQUFTLFdBMVBqQnRFLEVBQVF1RSxPQUFPLHdCQUNWQyxVQUFVLGNBQWV2RSxHQUc5QkEsRUFBWXdFLFNBQVcsVUFBVyxhQTBQbkNDLE9BQU8xRSIsImZpbGUiOiJzYWZlLm51bWVyaWMtdGV4dC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oYW5ndWxhcikge1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdzYWZlLm51bWVyaWMtdGV4dCcsIFtdKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ251bWVyaWNUZXh0JywgbnVtZXJpY1RleHQpO1xyXG5cclxuXHJcbiAgICBudW1lcmljVGV4dC4kaW5qZWN0ID0gWyckZmlsdGVyJywgJyR0aW1lb3V0J107XHJcblxyXG4gICAgZnVuY3Rpb24gbnVtZXJpY1RleHQoJGZpbHRlciwgJHRpbWVvdXQpIHtcclxuXHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBsaW5rRnVuYygkc2NvcGUsICRlbGVtZW50LCAkYXR0cnMsICRuZ01vZGVsKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIGZvcm1hdDogJGF0dHJzLmZvcm1hdCB8fCAnaW50JywgLy9mb3JtYXQgPT0gJ2RlY2ltYWwnIHx8ICdpbnQnIHx8ICdjdXJyZW5jeScgfHwgcGVyY2VudGFnZVxyXG4gICAgICAgICAgICAgICAgZGVjaW1hbFBsYWNlczogJGF0dHJzLmRlY2ltYWxQbGFjZXMgfHwgMixcclxuICAgICAgICAgICAgICAgIHN0ZXA6IHBhcnNlRmxvYXQoJGF0dHJzLnN0ZXApIHx8IDAsXHJcbiAgICAgICAgICAgICAgICBtYXhWYWx1ZTogJGF0dHJzLm1heFZhbHVlIHx8IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSxcclxuICAgICAgICAgICAgICAgIG1pblZhbHVlOiAkYXR0cnMubWluVmFsdWUgfHwgTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLFxyXG4gICAgICAgICAgICAgICAgY3VycmVuY3lTeW1ib2w6ICRhdHRycy5jdXJyZW5jeVN5bWJvbCB8fCAnJCcsXHJcbiAgICAgICAgICAgICAgICBlcnJvckNsYXNzOiAkYXR0cnMuZXJyb3JDbGFzcyB8fCAnaGFzLWVycm9yIFJlcXVpcmVkRmllbGQnXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5mb3JtYXQgPT0gJ3BlcmNlbnRhZ2UnKSB7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLmN1cnJlbmN5U3ltYm9sID0gJyUnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5mb3JtYXQgIT09ICdpbnQnICYmIG9wdGlvbnMuZm9ybWF0ICE9PSAnZGVjaW1hbCcgJiYgb3B0aW9ucy5mb3JtYXQgIT09ICdjdXJyZW5jeScgJiYgb3B0aW9ucy5mb3JtYXQgIT09ICdwZXJjZW50YWdlJykge1xyXG4gICAgICAgICAgICAgICAgcmFpc2VFeGVwdGlvbignSW52YWxpZCBGb3JtYXQnLFxyXG4gICAgICAgICAgICAgICAgJ0Zvcm1hdCBcIicgKyBvcHRpb25zLmZvcm1hdCArICdcIiBpcyBhbiBpbnZhbGlkIGZvcm1hdCBmb3IgbnVtZXJpYy10ZXh0LCBudW1lcmljLXRleHQgb25seSBhY2NlcHRzIHRoZSBmb2xsb3dpbmcgZm9ybWF0cywgXFxuIFwiaW50XCIgfHwgXCJkZWNpbWFsXCIgfHwgXCJjdXJyZW5jeVwiIHx8IFwicGVyY2VudGFnZVwiJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnN0ZXAgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICByYWlzZUV4ZXB0aW9uKCdTdGVwIHNob3VsZCBub3QgYmUgbmVnYXRpdmUnLCAnVGhlIHN0ZXAgbnVtYmVyIHNob3VsZCBiZSAwIG9yIGEgcG9zaXRpdmUgbnVtYmVyJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2Yob3B0aW9ucy5zdGVwKSAhPT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgICAgIHJhaXNlRXhlcHRpb24oJ1N0ZXAgdmFsdWUgaXMgbm90IGEgbnVtYmVyJywgJ1RoZSB2YWx1ZSBcIicgKyBvcHRpb25zLnN0ZXAgKyAnXCIgaW4gc3RlcCBpcyBub3QgYSBudW1iZXIsIHNob3VkIGJlIGEgbnVtYmVyIGdyZWF0ZXIgdGhhbiAwJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKG9wdGlvbnMuZGVjaW1hbFBsYWNlcyA8IDApe1xyXG4gICAgICAgICAgICAgIHJhaXNlRXhlcHRpb24oJ0RlY2ltYWxQbGFjZXMgc2hvdWxkIG5vdCBiZSBuZWdhdGl2ZScsJ1RoZSB2YWx1ZSBcIlwiIGluIGRlY2ltYWwtcGxhY2VzIGlzIGxlc3MgdGhlbiAwLCBzaG91bGQgYmUgYSBwb3NpdGl2ZSBudW1iZXInKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIGlucHV0ID0gJCgkZWxlbWVudCk7XHJcbiAgICAgICAgICAgIC8vJHNjb3BlLm5nTW9kZWwgPSAkc2NvcGUubmdNb2RlbCB8fCAwO1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gcGFyc2UodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgfHwgMDtcclxuICAgICAgICAgICAgICAgIHZhciByZWdleCA9IG5ldyBSZWdFeHAoXCJbXFxcXCxcXFxcXCIgKyBvcHRpb25zLmN1cnJlbmN5U3ltYm9sICsgXCJdXCIsICdnJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKS5yZXBsYWNlKHJlZ2V4LCAnJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHJhaXNlRXhlcHRpb24oZXJyb3IsIG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IHtcclxuICAgICAgICAgICAgICAgICAgICBFcnJvcjogZXJyb3IsXHJcbiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZTogbWVzc2FnZVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlTW9kZWwodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgfHwgaW5wdXQudmFsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJG5nTW9kZWwuJHNldFZpZXdWYWx1ZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJG5nTW9kZWwuJHJlbmRlcigpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldElucHV0VmFsdWUodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBmb3JtYXQgPSBvcHRpb25zLmZvcm1hdDtcclxuICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2UodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgaW5wdXQudmFsKGZvcm1hdHRlcihmb3JtYXQsIHZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVNb2RlbCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBmb3JtYXR0ZXIoZm9ybWF0LCB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZSB8fCAwO1xyXG4gICAgICAgICAgICAgICAgaWYgKGZvcm1hdCA9PSAnZGVjaW1hbCcpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGZpbHRlcignbnVtYmVyJykodmFsdWUsIG9wdGlvbnMuZGVjaW1hbFBsYWNlcyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PSAnaW50Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkZmlsdGVyKCdudW1iZXInKSh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PSAnY3VycmVuY3knIHx8IGZvcm1hdCA9PSAncGVyY2VudGFnZScpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGZpbHRlcignY3VycmVuY3knKShcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuY3VycmVuY3lTeW1ib2wsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGVjaW1hbFBsYWNlcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldElucHV0VmFsdWUoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpbnB1dC52YWwoKSB8fCAwO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWwoKSA9PT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5taW5WYWx1ZSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBvcHRpb25zLm1pblZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyIGZvcm1hdCA9IG9wdGlvbnMuZm9ybWF0O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChmb3JtYXQgPT0gJ2RlY2ltYWwnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQocGFyc2UodmFsdWUpKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09ICdpbnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KHBhcnNlKHZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PSAnY3VycmVuY3knIHx8IGZvcm1hdCA9PSAncGVyY2VudGFnZScpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChwYXJzZSh2YWx1ZSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBtb3ZlQ3Vyc29yVG9FbmQoZWwpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZWwuc2VsZWN0aW9uU3RhcnQgPT0gXCJudW1iZXJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsLnNlbGVjdGlvblN0YXJ0ID0gZWwuc2VsZWN0aW9uRW5kID0gZWwudmFsdWUubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZWwuY3JlYXRlVGV4dFJhbmdlICE9IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbC5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IGVsLmNyZWF0ZVRleHRSYW5nZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJhbmdlLmNvbGxhcHNlKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICByYW5nZS5zZWxlY3QoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gYXBwbHlJbnB1dFZhbHVlKHZhbHVlLCBldmVudCkge1xyXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+PSBvcHRpb25zLm1pblZhbHVlICYmIHZhbHVlIDw9IG9wdGlvbnMubWF4VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRJbnB1dFZhbHVlKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IG9wdGlvbnMubWluVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBmb3JtYXR0ZXIob3B0aW9ucy5mb3JtYXQsIG9wdGlvbnMubWluVmFsdWUgPT0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZID8gMCA6IG9wdGlvbnMubWluVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gb3B0aW9ucy5tYXhWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGZvcm1hdHRlcihvcHRpb25zLmZvcm1hdCwgb3B0aW9ucy5tYXhWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHNldElucHV0VmFsdWUodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGludmFsaWRhdGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gaW52YWxpZGF0ZSgpIHtcclxuICAgICAgICAgICAgICAgIGlucHV0LmFkZENsYXNzKG9wdGlvbnMuZXJyb3JDbGFzcyk7XHJcbiAgICAgICAgICAgICAgICBpbnB1dC5hdHRyKCd2YWxpZGEtY29udHJvbCcsIGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gdmFsaWRhdGUoKSB7XHJcbiAgICAgICAgICAgICAgICBpbnB1dC5yZW1vdmVDbGFzcyhvcHRpb25zLmVycm9yQ2xhc3MpO1xyXG4gICAgICAgICAgICAgICAgaW5wdXQuYXR0cigndmFsaWRhLWNvbnRyb2wnLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIHZhbHVlID0gMDtcclxuICAgICAgICAgICAgdmFyIG51bWJlck1hdGNoID0gL1swLTldLztcclxuICAgICAgICAgICAgaW5wdXQudW5iaW5kKCdrZXlkb3duJyk7XHJcbiAgICAgICAgICAgIGlucHV0Lm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZXZlbnQpIHtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3RlcCAhPT0gMCAmJiB0eXBlb2Yob3B0aW9ucy5zdGVwKSA9PSAnbnVtYmVyJykge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy9TdGVwIHVwXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gMzgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBnZXRJbnB1dFZhbHVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9IG9wdGlvbnMuc3RlcDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXBwbHlJbnB1dFZhbHVlKHZhbHVlLCBldmVudCk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleUNvZGUgPT0gNDApIHsgLy9TdGVwIGRvd25cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBnZXRJbnB1dFZhbHVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlIC09IG9wdGlvbnMuc3RlcDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXBwbHlJbnB1dFZhbHVlKHZhbHVlLCBldmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAvL01pbnVzXHJcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSAxODkpIHtcclxuICAgICAgICAgICAgICAgICAgICBhcHBseUlucHV0VmFsdWUoZ2V0SW5wdXRWYWx1ZSgpICogLTEsIGV2ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSAxOTAgJiYgb3B0aW9ucy5mb3JtYXQgIT0gJ2ludCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsKCkuaW5kZXhPZignLicpICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuc2hpZnRLZXkgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlzRnJvbU51bXBhZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGV2ZW50LmtleUNvZGUgPj0gOTYgJiYgZXZlbnQua2V5Q29kZSA8PSAxMDUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0Zyb21OdW1wYWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZighaXNGcm9tTnVtcGFkKXtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFudW1iZXJNYXRjaC50ZXN0KFN0cmluZy5mcm9tQ2hhckNvZGUoZXZlbnQua2V5Q29kZSkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSAhPSA4ICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQua2V5Q29kZSAhPSAzNyAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LmtleUNvZGUgIT0gMzkpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpbnB1dC51bmJpbmQoJ2tleXVwJyk7XHJcbiAgICAgICAgICAgIGlucHV0LnVuYmluZCgnY2hhbmdlJyk7XHJcbiAgICAgICAgICAgIGlucHV0Lm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICAgICAgICAgYXBwbHlJbnB1dFZhbHVlKGdldElucHV0VmFsdWUoKSwgZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgdmFsaWRhdGUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlucHV0LnVuYmluZCgnY2xpY2snKTtcclxuICAgICAgICAgICAgaW5wdXQub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9ICQodGhpcylbMF07XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTZWxlY3Rpb25SYW5nZSgwLCBfdGhpcy52YWx1ZS5sZW5ndGgpO1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlucHV0Lm9uKCdrZXl1cCcsIGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICB2YWxpZGF0ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGlucHV0LmNzcygndGV4dC1hbGlnbicsICdyaWdodCcpO1xyXG5cclxuICAgICAgICAgICAgJG5nTW9kZWwuJHBhcnNlcnMucHVzaChmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlKHZhbHVlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICRuZ01vZGVsLiRmb3JtYXR0ZXJzLnB1c2goZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+PSBvcHRpb25zLm1pblZhbHVlICYmIHZhbHVlIDw9IG9wdGlvbnMubWF4VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVNb2RlbChmb3JtYXR0ZXIob3B0aW9ucy5mb3JtYXQsIHZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdHRlcihvcHRpb25zLmZvcm1hdCwgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgb3B0aW9ucy5taW5WYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGZvcm1hdHRlcihvcHRpb25zLmZvcm1hdCwgb3B0aW9ucy5taW5WYWx1ZSA9PSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkgPyAwIDogb3B0aW9ucy5taW5WYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPiBvcHRpb25zLm1heFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZm9ybWF0dGVyKG9wdGlvbnMuZm9ybWF0LCBvcHRpb25zLm1heFZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZU1vZGVsKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0dGVyKG9wdGlvbnMuZm9ybWF0LCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgbGluazogbGlua0Z1bmMsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJ1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG59KSh3aW5kb3cuYW5ndWxhcik7XHJcbiJdfQ==
