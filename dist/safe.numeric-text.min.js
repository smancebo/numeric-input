!function(e){function n(e,n){function r(r,a,t,o){function u(e){e=e||0;var n=new RegExp("[\\,\\"+v.currencySymbol+"]","g");return e.toString().replace(n,"")}function i(e,n){throw{Error:e,Message:n}}function l(e){n(function(){e=e||y.val(),o.$setViewValue(e),o.$render()})}function c(e){var n=v.format;e=u(e),y.val(m(n,e)),l()}function m(n,r){return r=r||0,"decimal"==n?e("number")(r,v.decimalPlaces):"int"==n?e("number")(r):"currency"==n||"percentage"==n?e("currency")(r,v.currencySymbol,v.decimalPlaces):void 0}function s(){var e=y.val()||0;""===y.val()&&(e=v.minValue>0?v.minValue:0);var n=v.format;return"decimal"==n?parseFloat(u(e)):"int"==n?parseInt(u(e)):"currency"==n||"percentage"==n?parseFloat(u(e)):void 0}function f(e,n){n.preventDefault(),e>=v.minValue&&e<=v.maxValue?c(e):(e<v.minValue&&(e=m(v.format,v.minValue==Number.NEGATIVE_INFINITY?0:v.minValue)),e>v.maxValue&&(e=m(v.format,v.maxValue)),c(e),d())}function d(){y.addClass(v.errorClass),y.attr("valida-control",!1)}function p(){y.removeClass(v.errorClass),y.attr("valida-control",!0)}var v={format:t.format||"int",decimalPlaces:t.decimalPlaces||2,step:parseFloat(t.step)||0,maxValue:t.maxValue||Number.POSITIVE_INFINITY,minValue:t.minValue||Number.NEGATIVE_INFINITY,currencySymbol:t.currencySymbol||"$",errorClass:t.errorClass||"has-error RequiredField"};"percentage"==v.format&&(v.currencySymbol="%"),"int"!==v.format&&"decimal"!==v.format&&"currency"!==v.format&&"percentage"!==v.format&&i("Invalid Format",'Format "'+v.format+'" is an invalid format for numeric-text, numeric-text only accepts the following formats, \n "int" || "decimal" || "currency" || "percentage"'),v.step<0&&i("Step should not be negative","The step number should be 0 or a positive number"),"number"!=typeof v.step&&i("Step value is not a number",'The value "'+v.step+'" in step is not a number, shoud be a number greater than 0'),v.decimalPlaces<0&&i("DecimalPlaces should not be negative",'The value "" in decimal-places is less then 0, should be a positive number');var y=$(a),b=0,V=/[0-9]/;y.unbind("keydown"),y.on("keydown",function(e){return 0!==v.step&&"number"==typeof v.step&&(38==e.keyCode?(b=s(),b+=v.step,f(b,e)):40==e.keyCode&&(b=s(),b-=v.step,f(b,e))),189==e.keyCode?void f(s()*-1,e):190==e.keyCode&&"int"!=v.format?void(y.val().indexOf(".")!==-1&&e.preventDefault()):void(e.shiftKey===!1?V.test(String.fromCharCode(e.keyCode))||8!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode&&e.preventDefault():e.preventDefault())}),y.unbind("keyup"),y.unbind("change"),y.on("change",function(e){f(s(),e),p()}),y.unbind("focus"),y.on("focus",function(e){setTimeout(function(e){var n=e.value.length;return function(){void 0!==e.setSelectionRange?e.setSelectionRange(n,n):$(e).val(e.value)}}(this),0)}),y.on("keyup",function(e){p()}),y.css("text-align","right"),o.$parsers.push(function(e){return u(e)}),o.$formatters.push(function(e){return e>=v.minValue&&e<=v.maxValue?(l(m(v.format,e)),m(v.format,e)):(e<v.minValue&&(e=m(v.format,v.minValue==Number.NEGATIVE_INFINITY?0:v.minValue)),e>v.maxValue&&(e=m(v.format,v.maxValue)),l(e),m(v.format,e))})}return{restrict:"A",link:r,require:"ngModel"}}e.module("safe.numeric-text",[]).directive("numericText",n),n.$inject=["$filter","$timeout"]}(window.angular);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNhZmUubnVtZXJpYy10ZXh0LmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJudW1lcmljVGV4dCIsIiRmaWx0ZXIiLCIkdGltZW91dCIsImxpbmtGdW5jIiwiJHNjb3BlIiwiJGVsZW1lbnQiLCIkYXR0cnMiLCIkbmdNb2RlbCIsInBhcnNlIiwidmFsdWUiLCJyZWdleCIsIlJlZ0V4cCIsIm9wdGlvbnMiLCJjdXJyZW5jeVN5bWJvbCIsInRvU3RyaW5nIiwicmVwbGFjZSIsInJhaXNlRXhlcHRpb24iLCJlcnJvciIsIm1lc3NhZ2UiLCJFcnJvciIsIk1lc3NhZ2UiLCJ1cGRhdGVNb2RlbCIsImlucHV0IiwidmFsIiwiJHNldFZpZXdWYWx1ZSIsIiRyZW5kZXIiLCJzZXRJbnB1dFZhbHVlIiwiZm9ybWF0IiwiZm9ybWF0dGVyIiwiZGVjaW1hbFBsYWNlcyIsImdldElucHV0VmFsdWUiLCJtaW5WYWx1ZSIsInBhcnNlRmxvYXQiLCJwYXJzZUludCIsImFwcGx5SW5wdXRWYWx1ZSIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJtYXhWYWx1ZSIsIk51bWJlciIsIk5FR0FUSVZFX0lORklOSVRZIiwiaW52YWxpZGF0ZSIsImFkZENsYXNzIiwiZXJyb3JDbGFzcyIsImF0dHIiLCJ2YWxpZGF0ZSIsInJlbW92ZUNsYXNzIiwic3RlcCIsIlBPU0lUSVZFX0lORklOSVRZIiwiJCIsIm51bWJlck1hdGNoIiwidW5iaW5kIiwib24iLCJrZXlDb2RlIiwiaW5kZXhPZiIsInNoaWZ0S2V5IiwidGVzdCIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsInNldFRpbWVvdXQiLCJlbCIsInN0ckxlbmd0aCIsImxlbmd0aCIsInVuZGVmaW5lZCIsInNldFNlbGVjdGlvblJhbmdlIiwidGhpcyIsImNzcyIsIiRwYXJzZXJzIiwicHVzaCIsIiRmb3JtYXR0ZXJzIiwicmVzdHJpY3QiLCJsaW5rIiwicmVxdWlyZSIsIm1vZHVsZSIsImRpcmVjdGl2ZSIsIiRpbmplY3QiLCJ3aW5kb3ci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QVMsU0FBU2hCLEdBQ3ZCUyxNQUdKdEIsRUFBTTJDLElBQUksYUFBYyxTQUV4QjFELEVBQVMyRCxTQUFTQyxLQUFLLFNBQVMxRCxHQUM1QixNQUFPRCxHQUFNQyxLQUVqQkYsRUFBUzZELFlBQVlELEtBQUssU0FBUzFELEdBQy9CLE1BQUlBLElBQVNHLEVBQVFtQixVQUFZdEIsR0FBU0csRUFBUXlCLFVBQzlDaEIsRUFBWU8sRUFBVWhCLEVBQVFlLE9BQVFsQixJQUMvQm1CLEVBQVVoQixFQUFRZSxPQUFRbEIsS0FHN0JBLEVBQVFHLEVBQVFtQixXQUNoQnRCLEVBQVFtQixFQUFVaEIsRUFBUWUsT0FBUWYsRUFBUW1CLFVBQVlPLE9BQU9DLGtCQUFvQixFQUFJM0IsRUFBUW1CLFdBRzdGdEIsRUFBUUcsRUFBUXlCLFdBQ2hCNUIsRUFBUW1CLEVBQVVoQixFQUFRZSxPQUFRZixFQUFReUIsV0FHOUNoQixFQUFZWixHQUNMbUIsRUFBVWhCLEVBQVFlLE9BQVFsQixNQUs3QyxPQUNJNEQsU0FBVSxJQUNWQyxLQUFNbkUsRUFDTm9FLFFBQVMsV0ExUGpCeEUsRUFBUXlFLE9BQU8sd0JBQ1ZDLFVBQVUsY0FBZXpFLEdBRzlCQSxFQUFZMEUsU0FBVyxVQUFXLGFBMFBuQ0MsT0FBTzVFIiwiZmlsZSI6InNhZmUubnVtZXJpYy10ZXh0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbihhbmd1bGFyKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2FmZS5udW1lcmljLXRleHQnLCBbXSlcbiAgICAgICAgLmRpcmVjdGl2ZSgnbnVtZXJpY1RleHQnLCBudW1lcmljVGV4dCk7XG5cblxuICAgIG51bWVyaWNUZXh0LiRpbmplY3QgPSBbJyRmaWx0ZXInLCAnJHRpbWVvdXQnXTtcblxuICAgIGZ1bmN0aW9uIG51bWVyaWNUZXh0KCRmaWx0ZXIsICR0aW1lb3V0KSB7XG5cblxuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmtGdW5jKCRzY29wZSwgJGVsZW1lbnQsICRhdHRycywgJG5nTW9kZWwpIHtcblxuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgZm9ybWF0OiAkYXR0cnMuZm9ybWF0IHx8ICdpbnQnLCAvL2Zvcm1hdCA9PSAnZGVjaW1hbCcgfHwgJ2ludCcgfHwgJ2N1cnJlbmN5JyB8fCBwZXJjZW50YWdlXG4gICAgICAgICAgICAgICAgZGVjaW1hbFBsYWNlczogJGF0dHJzLmRlY2ltYWxQbGFjZXMgfHwgMixcbiAgICAgICAgICAgICAgICBzdGVwOiBwYXJzZUZsb2F0KCRhdHRycy5zdGVwKSB8fCAwLFxuICAgICAgICAgICAgICAgIG1heFZhbHVlOiAkYXR0cnMubWF4VmFsdWUgfHwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLFxuICAgICAgICAgICAgICAgIG1pblZhbHVlOiAkYXR0cnMubWluVmFsdWUgfHwgTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLFxuICAgICAgICAgICAgICAgIGN1cnJlbmN5U3ltYm9sOiAkYXR0cnMuY3VycmVuY3lTeW1ib2wgfHwgJyQnLFxuICAgICAgICAgICAgICAgIGVycm9yQ2xhc3M6ICRhdHRycy5lcnJvckNsYXNzIHx8ICdoYXMtZXJyb3IgUmVxdWlyZWRGaWVsZCdcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChvcHRpb25zLmZvcm1hdCA9PSAncGVyY2VudGFnZScpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLmN1cnJlbmN5U3ltYm9sID0gJyUnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5mb3JtYXQgIT09ICdpbnQnICYmIG9wdGlvbnMuZm9ybWF0ICE9PSAnZGVjaW1hbCcgJiYgb3B0aW9ucy5mb3JtYXQgIT09ICdjdXJyZW5jeScgJiYgb3B0aW9ucy5mb3JtYXQgIT09ICdwZXJjZW50YWdlJykge1xuICAgICAgICAgICAgICAgIHJhaXNlRXhlcHRpb24oJ0ludmFsaWQgRm9ybWF0JyxcbiAgICAgICAgICAgICAgICAnRm9ybWF0IFwiJyArIG9wdGlvbnMuZm9ybWF0ICsgJ1wiIGlzIGFuIGludmFsaWQgZm9ybWF0IGZvciBudW1lcmljLXRleHQsIG51bWVyaWMtdGV4dCBvbmx5IGFjY2VwdHMgdGhlIGZvbGxvd2luZyBmb3JtYXRzLCBcXG4gXCJpbnRcIiB8fCBcImRlY2ltYWxcIiB8fCBcImN1cnJlbmN5XCIgfHwgXCJwZXJjZW50YWdlXCInKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3RlcCA8IDApIHtcbiAgICAgICAgICAgICAgICByYWlzZUV4ZXB0aW9uKCdTdGVwIHNob3VsZCBub3QgYmUgbmVnYXRpdmUnLCAnVGhlIHN0ZXAgbnVtYmVyIHNob3VsZCBiZSAwIG9yIGEgcG9zaXRpdmUgbnVtYmVyJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2Yob3B0aW9ucy5zdGVwKSAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgICAgICByYWlzZUV4ZXB0aW9uKCdTdGVwIHZhbHVlIGlzIG5vdCBhIG51bWJlcicsICdUaGUgdmFsdWUgXCInICsgb3B0aW9ucy5zdGVwICsgJ1wiIGluIHN0ZXAgaXMgbm90IGEgbnVtYmVyLCBzaG91ZCBiZSBhIG51bWJlciBncmVhdGVyIHRoYW4gMCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZihvcHRpb25zLmRlY2ltYWxQbGFjZXMgPCAwKXtcbiAgICAgICAgICAgICAgcmFpc2VFeGVwdGlvbignRGVjaW1hbFBsYWNlcyBzaG91bGQgbm90IGJlIG5lZ2F0aXZlJywnVGhlIHZhbHVlIFwiXCIgaW4gZGVjaW1hbC1wbGFjZXMgaXMgbGVzcyB0aGVuIDAsIHNob3VsZCBiZSBhIHBvc2l0aXZlIG51bWJlcicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgaW5wdXQgPSAkKCRlbGVtZW50KTtcbiAgICAgICAgICAgIC8vJHNjb3BlLm5nTW9kZWwgPSAkc2NvcGUubmdNb2RlbCB8fCAwO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBwYXJzZSh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgfHwgMDtcbiAgICAgICAgICAgICAgICB2YXIgcmVnZXggPSBuZXcgUmVnRXhwKFwiW1xcXFwsXFxcXFwiICsgb3B0aW9ucy5jdXJyZW5jeVN5bWJvbCArIFwiXVwiLCAnZycpO1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZS50b1N0cmluZygpLnJlcGxhY2UocmVnZXgsICcnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gcmFpc2VFeGVwdGlvbihlcnJvciwgbWVzc2FnZSkge1xuICAgICAgICAgICAgICAgIHRocm93IHtcbiAgICAgICAgICAgICAgICAgICAgRXJyb3I6IGVycm9yLFxuICAgICAgICAgICAgICAgICAgICBNZXNzYWdlOiBtZXNzYWdlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlTW9kZWwodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZSB8fCBpbnB1dC52YWwoKTtcbiAgICAgICAgICAgICAgICAgICAgJG5nTW9kZWwuJHNldFZpZXdWYWx1ZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICRuZ01vZGVsLiRyZW5kZXIoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0SW5wdXRWYWx1ZSh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHZhciBmb3JtYXQgPSBvcHRpb25zLmZvcm1hdDtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICBpbnB1dC52YWwoZm9ybWF0dGVyKGZvcm1hdCwgdmFsdWUpKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVNb2RlbCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBmb3JtYXR0ZXIoZm9ybWF0LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgfHwgMDtcbiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0ID09ICdkZWNpbWFsJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGZpbHRlcignbnVtYmVyJykodmFsdWUsIG9wdGlvbnMuZGVjaW1hbFBsYWNlcyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT0gJ2ludCcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRmaWx0ZXIoJ251bWJlcicpKHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PSAnY3VycmVuY3knIHx8IGZvcm1hdCA9PSAncGVyY2VudGFnZScpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRmaWx0ZXIoJ2N1cnJlbmN5JykoXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuY3VycmVuY3lTeW1ib2wsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRlY2ltYWxQbGFjZXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0SW5wdXRWYWx1ZSgpIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpbnB1dC52YWwoKSB8fCAwO1xuXG4gICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbCgpID09PSAnJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5taW5WYWx1ZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gb3B0aW9ucy5taW5WYWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBmb3JtYXQgPSBvcHRpb25zLmZvcm1hdDtcblxuICAgICAgICAgICAgICAgIGlmIChmb3JtYXQgPT0gJ2RlY2ltYWwnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KHBhcnNlKHZhbHVlKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT0gJ2ludCcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KHBhcnNlKHZhbHVlKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT0gJ2N1cnJlbmN5JyB8fCBmb3JtYXQgPT0gJ3BlcmNlbnRhZ2UnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KHBhcnNlKHZhbHVlKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBtb3ZlQ3Vyc29yVG9FbmQoZWwpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGVsLnNlbGVjdGlvblN0YXJ0ID09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZWwuc2VsZWN0aW9uU3RhcnQgPSBlbC5zZWxlY3Rpb25FbmQgPSBlbC52YWx1ZS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZWwuY3JlYXRlVGV4dFJhbmdlICE9IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZWwuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJhbmdlID0gZWwuY3JlYXRlVGV4dFJhbmdlKCk7XG4gICAgICAgICAgICAgICAgICAgIHJhbmdlLmNvbGxhcHNlKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2Uuc2VsZWN0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBhcHBseUlucHV0VmFsdWUodmFsdWUsIGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPj0gb3B0aW9ucy5taW5WYWx1ZSAmJiB2YWx1ZSA8PSBvcHRpb25zLm1heFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNldElucHV0VmFsdWUodmFsdWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgb3B0aW9ucy5taW5WYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBmb3JtYXR0ZXIob3B0aW9ucy5mb3JtYXQsIG9wdGlvbnMubWluVmFsdWUgPT0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZID8gMCA6IG9wdGlvbnMubWluVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gb3B0aW9ucy5tYXhWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBmb3JtYXR0ZXIob3B0aW9ucy5mb3JtYXQsIG9wdGlvbnMubWF4VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHNldElucHV0VmFsdWUodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBpbnZhbGlkYXRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBpbnZhbGlkYXRlKCkge1xuICAgICAgICAgICAgICAgIGlucHV0LmFkZENsYXNzKG9wdGlvbnMuZXJyb3JDbGFzcyk7XG4gICAgICAgICAgICAgICAgaW5wdXQuYXR0cigndmFsaWRhLWNvbnRyb2wnLCBmYWxzZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlKCkge1xuICAgICAgICAgICAgICAgIGlucHV0LnJlbW92ZUNsYXNzKG9wdGlvbnMuZXJyb3JDbGFzcyk7XG4gICAgICAgICAgICAgICAgaW5wdXQuYXR0cigndmFsaWRhLWNvbnRyb2wnLCB0cnVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHZhbHVlID0gMDtcbiAgICAgICAgICAgIHZhciBudW1iZXJNYXRjaCA9IC9bMC05XS87XG4gICAgICAgICAgICBpbnB1dC51bmJpbmQoJ2tleWRvd24nKTtcbiAgICAgICAgICAgIGlucHV0Lm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZXZlbnQpIHtcblxuXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3RlcCAhPT0gMCAmJiB0eXBlb2Yob3B0aW9ucy5zdGVwKSA9PSAnbnVtYmVyJykge1xuXG5cbiAgICAgICAgICAgICAgICAgICAgLy9TdGVwIHVwXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09IDM4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGdldElucHV0VmFsdWUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9IG9wdGlvbnMuc3RlcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGx5SW5wdXRWYWx1ZSh2YWx1ZSwgZXZlbnQpO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC5rZXlDb2RlID09IDQwKSB7IC8vU3RlcCBkb3duXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGdldElucHV0VmFsdWUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlIC09IG9wdGlvbnMuc3RlcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGx5SW5wdXRWYWx1ZSh2YWx1ZSwgZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgICAgICAvL01pbnVzXG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gMTg5KSB7XG4gICAgICAgICAgICAgICAgICAgIGFwcGx5SW5wdXRWYWx1ZShnZXRJbnB1dFZhbHVlKCkgKiAtMSwgZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09IDE5MCAmJiBvcHRpb25zLmZvcm1hdCAhPSAnaW50Jykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsKCkuaW5kZXhPZignLicpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChldmVudC5zaGlmdEtleSA9PT0gZmFsc2UpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIW51bWJlck1hdGNoLnRlc3QoU3RyaW5nLmZyb21DaGFyQ29kZShldmVudC5rZXlDb2RlKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlICE9IDggJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5rZXlDb2RlICE9IDM3ICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQua2V5Q29kZSAhPSAzOSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlucHV0LnVuYmluZCgna2V5dXAnKTtcbiAgICAgICAgICAgIGlucHV0LnVuYmluZCgnY2hhbmdlJyk7XG4gICAgICAgICAgICBpbnB1dC5vbignY2hhbmdlJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBhcHBseUlucHV0VmFsdWUoZ2V0SW5wdXRWYWx1ZSgpLCBldmVudCk7XG4gICAgICAgICAgICAgICAgdmFsaWRhdGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaW5wdXQudW5iaW5kKCdmb2N1cycpO1xuICAgICAgICAgICAgaW5wdXQub24oJ2ZvY3VzJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KChmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3RyTGVuZ3RoID0gZWwudmFsdWUubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWwuc2V0U2VsZWN0aW9uUmFuZ2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLnNldFNlbGVjdGlvblJhbmdlKHN0ckxlbmd0aCwgc3RyTGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChlbCkudmFsKGVsLnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KHRoaXMpKSwgMCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlucHV0Lm9uKCdrZXl1cCcsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgdmFsaWRhdGUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpbnB1dC5jc3MoJ3RleHQtYWxpZ24nLCAncmlnaHQnKTtcblxuICAgICAgICAgICAgJG5nTW9kZWwuJHBhcnNlcnMucHVzaChmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZSh2YWx1ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRuZ01vZGVsLiRmb3JtYXR0ZXJzLnB1c2goZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPj0gb3B0aW9ucy5taW5WYWx1ZSAmJiB2YWx1ZSA8PSBvcHRpb25zLm1heFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZU1vZGVsKGZvcm1hdHRlcihvcHRpb25zLmZvcm1hdCwgdmFsdWUpKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdHRlcihvcHRpb25zLmZvcm1hdCwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgb3B0aW9ucy5taW5WYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBmb3JtYXR0ZXIob3B0aW9ucy5mb3JtYXQsIG9wdGlvbnMubWluVmFsdWUgPT0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZID8gMCA6IG9wdGlvbnMubWluVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gb3B0aW9ucy5tYXhWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBmb3JtYXR0ZXIob3B0aW9ucy5mb3JtYXQsIG9wdGlvbnMubWF4VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlTW9kZWwodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0dGVyKG9wdGlvbnMuZm9ybWF0LCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgIGxpbms6IGxpbmtGdW5jLFxuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnXG4gICAgICAgIH07XG4gICAgfVxuXG59KSh3aW5kb3cuYW5ndWxhcik7XG4iXX0=
